整理自AWS Blog https://aws.amazon.com/blogs/database/key-components-of-a-data-driven-agentic-ai-application/

Agentic AI能够提升生产效率，解决传统软件不能解决的问题，简化集成，找到之前不可见的答案。 Agentic AI系统自动决定如何以及调用何种action（动作）来完成一个任务，并能随着更多信息来逐步调整计划。但是，这里还需要人工的操作，需要人工通过自然语言给出提示词，并进行管控。人类聚焦在目标上，agent聚焦在找到完成目标需要执行的细节上。当人机交互界面发生变化时，AgentAI系统仍然可以依赖于相同的后端来完成任务。以买玩具汽车为例，Agentic AI系统能够调用购买、库存更新、物流以及订单确认的工作流，在这些工作流中需要调用相同的后端服务和数据库。但问题是：Agentic AI系统是否能够直接和数据库来交互来获取库存信息或者调用信用卡网络API来付费？也就是：Agentic AI系统通过什么方式与数据交互？

在这篇博客中，作者探讨了直接数据库访问来替代智能体AI服务的成本、收益和缺点，包括在生产中验证过的有效的方式，以及还需要构建的服务。

**Agentic AI 系统的架构**

Agentic AI应用的核心是一个循环（loop）。当用户让系统完成一项任务时，工作流就进入了一个event loop，在这个loop中会不断迭代，直至认为完成了任务或回答了用户的问题。系统可能会回到用户那里寻求更多信息。这个loop实际上就是Reason+Act（ReAct）loop，是Agentic AI系统最流行的设计模式。

![Agentic AI设计Loop](https://d2908q01vomqb2.cloudfront.net/887309d048beef83ad3eabf2a79a64a389ab1c9f/2025/10/02/DBBLOG-5187-2.png)


ReAct模式被广泛应用在各式Agent中，比如Chatbot，商业流程自动化Agent、研究类Agent等。实现过程中，可以利用**Agent开发框架**如StrandsAgent、LangGraph，**托管服务**如Amazon Bedrock AgentCore，以及**用户Agent应用**如Amazon Q Business、Q Developer、Claude Desktop等。实现这类Agent，通常需要考虑如下模块：

1.上下文管理模块。负责为每一轮循环检索、汇聚和过滤所需数据。数据来源包括会话状态、历史记忆（如会话历史、用户偏好等）以及工具执行结果。检索数据后，该模块会选择最相关的信息放入下一轮LLM调用的上下文窗口中。

2.推理和规划模块。负责理解用户意图，结合相关上下文来制定或调整行动计划。该模块会判断当前信息是否足够回答用户问题，如果不够就继续执行循环，将每次的结果保存到记忆中，直到完成用户任务。

3.工具/Action执行模块。使用可用工具来执行完成用户任务的具体行动。该模块接收推理和规划模块提供的参数作为工具调用的输入，然后将执行结果传递给上下文管理模块，用于下一轮循环。

这个架构使得Agentic AI应用能够在设计范围内，通过多轮Event Loop来完成指定的任务。在执行任务过程中，Event Loop循环次数越多，系统效率越低。由于LLM调用次数不可预测，会带来不确定的输入/输出token消耗，进而影响成本和性能。从Event Loop中跳出来向用户获取更多数据同样也会影响成本和性能。接下来我们来看有哪些机制可以优化这个loop和用户体验。


**Agentic AI应用的上下文管理模块**

尽管AI Agent获得了大模型的复杂推理能力，但是他们面临着这些模型的两个限制。首先，大模型是无状态的，无法记住过去的对话信息，也无法自己维护上下文。其次，大模型的固定大小的上下文窗口限制了每一步能够处理的数据量。

上下文管理模块帮助开发者来管理Agent每个Event Loop的上下文窗口。上下文工程就是指在Agent执行的每一步中如何选择合适恰当的信息。这些信息可能包括用户指令（系统/用户提示词，工具描述等）、之前的记忆（会话历史、用户偏好等）、外部知识（企业知识库、权威数据源等）、工具执行结果（API调用结果），以及其它数据源。


